<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:linear_programming_solver.ViewModels"
             xmlns:m="using:linear_programming_solver.Models"
             x:Class="linear_programming_solver.Views.UserControls.TableauIterationsView"
             x:DataType="vm:TableauIterationsViewModel">
    
    <DockPanel Margin="20">
        <!-- Title -->
        <Border DockPanel.Dock="Top" 
                BorderBrush="Gray" 
                BorderThickness="0,0,0,1" 
                Padding="0,0,0,10" 
                Margin="0,0,0,20">
            <TextBlock Text="Algorithm Iterations" 
                      FontSize="24" 
                      FontWeight="Bold" 
                      HorizontalAlignment="Center" />
        </Border>
        
        <!-- Main Content -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            
            <!-- Left Panel: Hierarchical Tree Structure -->
            <Border Grid.Column="0" 
                    BorderBrush="Gray" 
                    BorderThickness="1" 
                    CornerRadius="5"
                    Padding="10">
                <StackPanel Spacing="10">
                    <TextBlock Text="Iterations" 
                              FontSize="16" 
                              FontWeight="Bold" 
                              HorizontalAlignment="Center" />
                    
                    <TreeView ItemsSource="{Binding IterationTree}"
                             SelectedItem="{Binding SelectedIterationNode}"
                             Background="White"
                             BorderBrush="LightGray"
                             BorderThickness="1">
                        <TreeView.Styles>
                            <Style Selector="TreeViewItem">
                                <Setter Property="IsExpanded" Value="True" />
                                <Setter Property="Padding" Value="5" />
                            </Style>
                            <Style Selector="TreeViewItem:selected /template/ ContentPresenter#PART_ContentPresenter">
                                <Setter Property="Background" Value="#E3F2FD" />
                            </Style>
                        </TreeView.Styles>
                        
                        <TreeView.ItemTemplate>
                            <TreeDataTemplate ItemsSource="{Binding Children}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <!-- Algorithm Type Icon -->
                                    <Border Background="{Binding BackgroundBrush}" 
                                           BorderBrush="{Binding BorderBrush}" 
                                           BorderThickness="2" 
                                           CornerRadius="3" 
                                           Padding="4,2">
                                        <TextBlock Text="{Binding Icon}" 
                                                  FontSize="10" 
                                                  FontWeight="Bold" 
                                                  Foreground="White" />
                                    </Border>
                                    
                                    <!-- Node Text -->
                                    <TextBlock Text="{Binding DisplayName}" 
                                              FontSize="12" 
                                              VerticalAlignment="Center"
                                              FontWeight="{Binding FontWeight}" />
                                    
                                    <!-- Status Indicator -->
                                    <TextBlock Text="{Binding StatusIndicator}" 
                                              FontSize="10" 
                                              Foreground="{Binding StatusColor}" 
                                              VerticalAlignment="Center" 
                                              IsVisible="{Binding HasStatus}" />
                                </StackPanel>
                            </TreeDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                </StackPanel>
            </Border>
            
            <!-- Splitter -->
            <GridSplitter Grid.Column="1" 
                         Background="Gray" 
                         ResizeDirection="Columns" />
            
            <!-- Right Panel: Iteration Details DataGrid -->
            <Border Grid.Column="2" 
                    BorderBrush="Gray" 
                    BorderThickness="1" 
                    CornerRadius="5"
                    Padding="15">
                <ScrollViewer>
                    <StackPanel Spacing="15">
                        <!-- Header -->
                        <Border Background="#F5F5F5" 
                               BorderBrush="#CCCCCC" 
                               BorderThickness="1" 
                               CornerRadius="5" 
                               Padding="12">
                            <StackPanel Spacing="8">
                                <TextBlock Text="{Binding SelectedIterationDetails.Title}" 
                                          FontSize="18" 
                                          FontWeight="Bold" 
                                          HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding SelectedIterationDetails.Description}" 
                                          FontSize="12" 
                                          Foreground="#666666" 
                                          HorizontalAlignment="Center" 
                                          TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>
                        
                        <!-- Tableau DataGrid -->
                        <Border BorderBrush="#DDDDDD" 
                               BorderThickness="1" 
                               CornerRadius="3">
                            <StackPanel Spacing="0">
                                <!-- DataGrid Header -->
                                <Border Background="#4A90E2" 
                                       Padding="10,8">
                                    <TextBlock Text="Tableau" 
                                              FontSize="14" 
                                              FontWeight="Bold" 
                                              Foreground="White" 
                                              HorizontalAlignment="Center" />
                                </Border>
                                
                                <!-- DataGrid -->
                                <DataGrid ItemsSource="{Binding SelectedIterationDetails.TableauRows}"
                                         AutoGenerateColumns="False"
                                         GridLinesVisibility="All"
                                         HeadersVisibility="Column"
                                         FontSize="11"
                                         MinHeight="200"
                                         CanUserReorderColumns="False"
                                         CanUserResizeColumns="True"
                                         CanUserSortColumns="False"
                                         IsReadOnly="True"
                                         Background="White">
                                    
                                    <DataGrid.Styles>
                                        <Style Selector="DataGridColumnHeader">
                                            <Setter Property="Background" Value="#F0F0F0" />
                                            <Setter Property="FontWeight" Value="Bold" />
                                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                                        </Style>
                                    </DataGrid.Styles>
                                    
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Basis" 
                                                          Binding="{Binding BasisVariable}"
                                                          Width="80"
                                                          FontWeight="Bold"/>
                                        <DataGridTextColumn Header="x1" 
                                                          Binding="{Binding Coefficients[0], StringFormat=F3}"
                                                          Width="70"/>
                                        <DataGridTextColumn Header="x2" 
                                                          Binding="{Binding Coefficients[1], StringFormat=F3}"
                                                          Width="70"/>
                                        <DataGridTextColumn Header="x3" 
                                                          Binding="{Binding Coefficients[2], StringFormat=F3}"
                                                          Width="70"/>
                                        <DataGridTextColumn Header="s1" 
                                                          Binding="{Binding Coefficients[3], StringFormat=F3}"
                                                          Width="70"/>
                                        <DataGridTextColumn Header="s2" 
                                                          Binding="{Binding Coefficients[4], StringFormat=F3}"
                                                          Width="70"/>
                                        <DataGridTextColumn Header="RHS" 
                                                          Binding="{Binding FormattedRhs}"
                                                          Width="80"
                                                          FontWeight="Bold"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                        
                        <!-- Pivot Information -->
                        <Border Background="{Binding SelectedIterationDetails.PivotInfoBackground}" 
                               BorderBrush="{Binding SelectedIterationDetails.PivotInfoBorder}" 
                               BorderThickness="2" 
                               CornerRadius="5" 
                               Padding="12"
                               IsVisible="{Binding SelectedIterationDetails.HasPivotInfo}">
                            <StackPanel Spacing="5">
                                <TextBlock Text="Pivot Information" 
                                          FontSize="14" 
                                          FontWeight="Bold" 
                                          Foreground="DarkBlue" />
                                <TextBlock Text="{Binding SelectedIterationDetails.PivotInfo}" 
                                          FontSize="12" 
                                          TextWrapping="Wrap" 
                                          Foreground="#333333" />
                                <TextBlock Text="{Binding SelectedIterationDetails.PivotDetails}" 
                                          FontSize="11" 
                                          TextWrapping="Wrap" 
                                          Foreground="#666666" 
                                          IsVisible="{Binding SelectedIterationDetails.HasPivotDetails}" />
                            </StackPanel>
                        </Border>
                        
                        <!-- Additional Information -->
                        <Border Background="#F8F9FA" 
                               BorderBrush="#DEE2E6" 
                               BorderThickness="1" 
                               CornerRadius="3" 
                               Padding="10"
                               IsVisible="{Binding SelectedIterationDetails.HasAdditionalInfo}">
                            <StackPanel Spacing="5">
                                <TextBlock Text="Additional Information" 
                                          FontSize="12" 
                                          FontWeight="Bold" />
                                <TextBlock Text="{Binding SelectedIterationDetails.AdditionalInfo}" 
                                          FontSize="11" 
                                          TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
    </DockPanel>
</UserControl>